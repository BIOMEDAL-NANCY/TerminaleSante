<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Résultats des Examens</title>
    <style>
        body {
            font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            background-color: #f4f4f9;
            text-align: center;
            padding: 20px;
        }
        table {
            margin-top: 20px;
            width: 80%;
            margin: auto;
            border-collapse: collapse;
        }
        th, td {
            padding: 10px;
            border: 1px solid #dddddd39;
        }
        th {
            background-color: #0a2b47;
            color: white;
        }
        input[type="text"] {
            padding: 10px;
            width: 200px;
            font-size: 16px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #0a2b47;
            color: white;
            border: none;
            cursor: pointer;
        }
        

        .header {
            text-align: center;  /* Centre le contenu horizontalement */
            margin-top: 20px;    /* Ajoute un espace au-dessus de l'image */
        }

        .logo {
            width: 400px;        /* Ajuste la taille de l'image selon ton besoin */
            height: auto;        /* Conserve les proportions de l'image */
        }

        /* Style de la table */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 10px;
            text-align: center;
        }

        /* Style pour les bonnes réponses (vert) */
        .correct {
            background-color: #28a745;
            color: white;
        }

        /* Style pour les mauvaises réponses (rouge) */
        .incorrect {
            background-color: #dc3545;
            color: white;
        }


    </style>

</head>


<body>

    <!-- Ajout de l'image -->
    <div class="header">
        <img src="Logo_Terminale_Sante.png" alt="Logo" class="logo">
    </div>

    <h1>Résultats des Examens</h1>
    <p>Entrez votre numéro d'anonymat pour consulter vos résultats :</p>
    
    <input type="text" id="studentID" placeholder="Numéro d'anonymat">
    <button onclick="searchResults()">Consulter mes résultats</button>

    <div id="result"></div>

    <script>
        // Lien vers ton fichier CSV Google Sheets (ce fichier doit être public)
        const csvUrl = "https://raw.githubusercontent.com/BIOMEDAL-NANCY/TerminaleSante/refs/heads/main/Examen_blanc_BIOMEDAL.csv";

        // Réponses correctes des QCM
        const correctAnswers = ['A', 'AB', 'C', 'A', 'D', 'B', 'C', 'A', 'D', 'B', 'C', 'A', 'B', 'C', 'D', 'B', 'A', 'C', 'D', 'B', 'A', 'C', 'B', 'D', 'A', 'C', 'B', 'D', 'A', 'C', 'B', 'A', 'C', 'B', 'D', 'A', 'C', 'B', 'D', 'A', 'C', 'B', 'A', 'C', 'B', 'D', 'A', 'C', 'B', 'D', 'A', 'C', 'B', 'A', 'C', 'B', 'D', 'A'];

        function searchResults() {
            const studentID = document.getElementById("studentID").value;
            if (!studentID) {
                alert("Veuillez entrer un numéro d'anonymat.");
                return;
            }

            console.log("Tentative de récupération des résultats pour le numéro d'anonymat : ", studentID);

            fetch(csvUrl)
                .then(response => response.text())
                .then(data => {
                    console.log("Données CSV récupérées : ", data); // Afficher les données CSV dans la console pour voir si elles sont bien récupérées
                    const rows = data.split("\n");
                    let resultFound = false;
                    let note = 0;
                    let studentRank = "";
                    let studentAnswers = [];

                    rows.forEach((row, index) => {
                        if (index === 0) return; // Ignore la première ligne (en-têtes)
                        const columns = row.split(",");
                        
                        // Si la première colonne (Numéro d'anonymat) correspond à celui de l'étudiant
                        if (columns[0] === studentID) {
                            note = parseFloat(columns[1]); // Note 
                            studentRank = columns[2]; // Rang de l'étudiant
                            
                            // Récupère les réponses des QCM
                            studentAnswers = columns.slice(3, 63); // Les réponses aux 60 QCM
                            resultFound = true;
                        }
                    });

                    const resultDiv = document.getElementById("result");
                    if (resultFound) {
                        // Afficher les résultats de l'étudiant
                        resultDiv.innerHTML = `
                            <h2>Résultats pour n°${studentID}</h2>
                            <p><strong>Note</strong> : ${note}</p>
                            <p><strong>Rang</strong> : ${studentRank}</p>
                        `;

                        // Afficher les réponses aux QCM
                        let answersHtml = '<h3>Réponses aux QCM :</h3><table class="answers-table"><thead><tr><th>Question</th><th>Réponse étudiante</th><th>Réponse correcte</th></tr></thead><tbody>';
                        
                        studentAnswers.forEach((answer, index) => {
                            const correctAnswer = correctAnswers[index];
                            

                            const rowClass = (answer === correctAnswer) ? 'correct' : 'incorrect';
                            console.log(`QCM ${index + 1}: Réponse de l'étudiant = ${answer}, Réponse correcte = ${correctAnswer}, class - ${rowClass}`);
                            answersHtml += `
                                <tr class="${rowClass}">
                                    <td>Question ${index + 1}</td>
                                    <td>${answer}</td>
                                    <td>${correctAnswer}</td>
                                </tr>
                            `;
                        });
                        
                        answersHtml += '</tbody></table>';
                        resultDiv.innerHTML += answersHtml; // Ajouter les réponses à la page
                    } else {
                        resultDiv.innerHTML = "<p>Aucun résultat trouvé pour ce numéro d'anonymat.</p>";
                    }
                })
                .catch(error => {
                    console.error("Erreur lors de la récupération des résultats : ", error);
                    alert("Une erreur est survenue lors de la récupération des résultats.");
                });
        }
    </script>

</body>
</html>
